pipeline{
  agent any 
  environment{
    REGISTRY= "shriram2105"
    IMAGE_FRONTEND= "notebook-frontend"
    IMAGE_BACKEND= "notebook-backend"
    IMAGE_TAG= "${env.BUILD_NUMBER}"
    DOCKER_CREDS= "DOCKER_CREDS"
}
  stages{
    stage("Checkout"){
      steps{
        checkout scm
      }
    }
    stage('Build Docker Imagers'){
      steps{
        sh """ 
        echo "Building frontend...."
        //add accurate dir for jenkins to navigate depending on where it is installed and how configured
        cd /var/jenkins_home/workspace/Notebook-App_feature/NoteBook/app/FrontEnd
        docker build -t ${REGISTRY}/${IMAGE_FRONTEND}:${IMAGE_TAG} .

        echo "Building Backend...."
        cd ../BackEnd
        docker build -t ${REGISTRY}/${IMAGE_BACKEND}:${IMAGE_TAG} .
        """
      }
    }
    stage("push Images to Docker hub"){
      steps{
        withCredentials([usernamePassword(credentialsId: DOCKER_CREDS , usernameVarible: 'DOCKER_USER',
        passwordVariable: 'DOCKER_PASS')])
        sh """

        echo "$DOCKER_PASS" | docker login -u "$DOCKER_USER" --pass-stdin

        docker push ${REGISTRY}/${IMAGE_FRONTEND}:${IMAGE_TAG}
        docker push ${REGISTRY}/${IMAGE_BACKEND}:${IMAGE_TAG}

        docker tag ${REGISTRY}/${IMAGE_FRONTEND}:${IMAGE_TAG}  ${REGISTRY}/${IMAGE_FRONTEND}:latest
        docker push ${REGISTRY}/${IMAGE_FRONTEND}:latest

        docker tag ${REGISTRY}/${IMAGE_BACKEND}:${IMAGE_TAG}  ${REGISTRY}/${IMAGE_BACKEND}:latest
        docker push ${REGISTRY}/${IMAGE_BACKEND}:latest

        """
      }
    }
  }
  post{
    always{
        echo "build finished with status: ${currentBuild.currentResult}"
    }
    success{
      echo "Build was successful. Docker image pushed to the registry."
    }
    failure{
       echo "Build failed. Please check the logs for more details."
    }
  }
}